!function(){"use strict";var e={d:function(n,r){for(var t in r)e.o(r,t)&&!e.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:r[t]})},o:function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}},n={};e.d(n,{default:function(){return b}});var r=Object.freeze({types:{service:["administration","bank","book","cemetery","firefighter","mail","music","police","school"],care:["animal","defibrillator","dental","lab","medic","pharmacy"],catering:["bar","cellar","restaurant","tobacco"],sport:["basket","bocce","foot","pingpong","pool","rugby","skate","tennis"],shop:["beauty","bakery","butcher","diy","fish","garden","grocery"],nature:["park","recycle"],transport:["bus","car","gas","train"],tourism:["castle","church","landmark","museum","tourism"]},subtypes:{restaurant:new window.L.Icon({iconUrl:"assets/images/marker/restaurant.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),bar:new window.L.Icon({iconUrl:"assets/images/marker/bar.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),cellar:new window.L.Icon({iconUrl:"assets/images/marker/cellar.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),tobacco:new window.L.Icon({iconUrl:"assets/images/marker/tobacco.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),grocery:new window.L.Icon({iconUrl:"assets/images/marker/grocery.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),diy:new window.L.Icon({iconUrl:"assets/images/marker/diy.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),beauty:new window.L.Icon({iconUrl:"assets/images/marker/beauty.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),foot:new window.L.Icon({iconUrl:"assets/images/marker/foot.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),rugby:new window.L.Icon({iconUrl:"assets/images/marker/rugby.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),basket:new window.L.Icon({iconUrl:"assets/images/marker/basket.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),pool:new window.L.Icon({iconUrl:"assets/images/marker/pool.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),pingpong:new window.L.Icon({iconUrl:"assets/images/marker/pingpong.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),skate:new window.L.Icon({iconUrl:"assets/images/marker/skate.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),bocce:new window.L.Icon({iconUrl:"assets/images/marker/bocce.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),tennis:new window.L.Icon({iconUrl:"assets/images/marker/tennis.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),bakery:new window.L.Icon({iconUrl:"assets/images/marker/bakery.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),fish:new window.L.Icon({iconUrl:"assets/images/marker/fish.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),butcher:new window.L.Icon({iconUrl:"assets/images/marker/butcher.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),book:new window.L.Icon({iconUrl:"assets/images/marker/book.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),music:new window.L.Icon({iconUrl:"assets/images/marker/music.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),landmark:new window.L.Icon({iconUrl:"assets/images/marker/landmark.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),castle:new window.L.Icon({iconUrl:"assets/images/marker/castle.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),church:new window.L.Icon({iconUrl:"assets/images/marker/church.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),tourism:new window.L.Icon({iconUrl:"assets/images/marker/tourism.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),museum:new window.L.Icon({iconUrl:"assets/images/marker/museum.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),garden:new window.L.Icon({iconUrl:"assets/images/marker/garden.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),car:new window.L.Icon({iconUrl:"assets/images/marker/car.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),gas:new window.L.Icon({iconUrl:"assets/images/marker/gas.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),train:new window.L.Icon({iconUrl:"assets/images/marker/train.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),bus:new window.L.Icon({iconUrl:"assets/images/marker/bus.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),animal:new window.L.Icon({iconUrl:"assets/images/marker/animal.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),dental:new window.L.Icon({iconUrl:"assets/images/marker/dental.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),pharmacy:new window.L.Icon({iconUrl:"assets/images/marker/pharmacy.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),medic:new window.L.Icon({iconUrl:"assets/images/marker/medic.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),lab:new window.L.Icon({iconUrl:"assets/images/marker/lab.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),defibrillator:new window.L.Icon({iconUrl:"assets/images/marker/defibrillator.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),cemetery:new window.L.Icon({iconUrl:"assets/images/marker/cemetery.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),firefighter:new window.L.Icon({iconUrl:"assets/images/marker/firefighter.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),police:new window.L.Icon({iconUrl:"assets/images/marker/police.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),mail:new window.L.Icon({iconUrl:"assets/images/marker/mail.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),bank:new window.L.Icon({iconUrl:"assets/images/marker/bank.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),park:new window.L.Icon({iconUrl:"assets/images/marker/park.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),recycle:new window.L.Icon({iconUrl:"assets/images/marker/recycle.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),administration:new window.L.Icon({iconUrl:"assets/images/marker/administration.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),school:new window.L.Icon({iconUrl:"assets/images/marker/school.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]}),user:new window.L.Icon({iconUrl:"assets/images/marker/user.svg",iconSize:[26,26],iconAnchor:[13,13],popupAnchor:[0,-13],shadowUrl:"assets/images/marker/marker-shadow.png",shadowSize:[42,42],shadowAnchor:[20,20]})}}),t=function(e,n){var r=Math.pow(10,n||0);return Math.round(e*r)/r},a={CCDH_CENTER:{LAT:48.53183906441962,LNG:2.053756713867188},CCDH_CITIES:["BRX","COR","DRD","LFR","LGR","RIC","ROV","SCD","SER","STC","VSG"],MAP_BOUNDS:window.L.latLngBounds(window.L.latLng(4.679400715963894,1.7390606689453127),window.L.latLng(98.38439074151866,2.34339599609375)),OSM_LAYER:window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',maxZoom:19,minZoom:11}),ESRI_LAYER:window.L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:'&copy; <a href="https://www.arcgis.com/home/item.html?id=10df2279f9684e4a9f6a7f08febac2a9">Esri Imagery</a>',maxZoom:19,minZoom:11}),getDistanceBetweenCoords:function(e,n){var r=e[1]*Math.PI/180,t=e[0]*Math.PI/180,a=n[1]*Math.PI/180,o=n[0]*Math.PI/180,s=o-t,i=a-r,c=Math.pow(Math.sin(s/2),2)+Math.cos(t)*Math.cos(o)*Math.pow(Math.sin(i/2),2);return 2*Math.asin(Math.sqrt(c))*6371*1e3},convertDistanceToString:function(e){return e>1e3?"".concat(t(e/1e3,2),"km"):"".concat(t(e,2),"m")},buildDistanceETA:function(e){var n,r=0;n=(r=e>5e4?e/1e5*60:e>1e4?e/6e4*60:e/3e4*60)%1,r=(r=Math.floor(r))>60?"".concat(Math.floor(r/60),"h ").concat(r%60,"m"):"".concat(r,"m");var a=e/5e3*60,o=a%1;return a=(a=Math.floor(a))>60?"".concat(Math.floor(a/60),"h ").concat(a%60,"m"):"".concat(a,"m"),{car:"".concat(r," ").concat(Math.floor(100*t(n/100*60,2)),"s"),walk:"".concat(a," ").concat(Math.floor(100*t(o/100*60,2)),"s")}},precisionRound:t,fetchModal:function(e){return new Promise((function(n){fetch("./assets/html/".concat(e,".html")).then((function(e){e.text().then((function(e){n(document.createRange().createContextualFragment(e))}))}))}))},closeModal:function(e,n){!0!==n&&"modal-overlay"!==e.target.id&&-1===e.target.id.indexOf("close")||(document.getElementById("modal-overlay").style.opacity=0,setTimeout((function(){document.getElementById("modal-overlay").style.display="none",document.getElementById("modal-overlay").innerHTML=""}),300))}};function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function s(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,i(t.key),t)}}function i(e){var n=function(e,n){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,"string");if("object"!=o(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(n)?n:n+""}var c=function(){return e=function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)},n=[{key:"createMarkerPopup",value:function(e){var n=document.createElement("DIV"),r=document.createElement("H3"),t=document.createElement("I"),a=document.createElement("I"),o=document.createElement("A"),s=document.createElement("A"),i=document.createElement("P"),c=document.createElement("A");n.classList.add("marker-popup"),r.innerHTML=e.mark.name,t.innerHTML=e.mark.address,a.innerHTML=e.mark.town,o.href="tel:".concat(e.mark.phone),o.innerHTML='<img src="./assets/images/icon/phone.svg">'.concat(e.mark.phone),s.href=e.mark.website,s.innerHTML='<img src="./assets/images/icon/web.svg">Consulter le site',s.setAttribute("rel","noopener noreferrer"),s.setAttribute("target","_blank"),i.innerHTML=e.mark.info,c.href="geo:".concat(e.mark.lat,",").concat(e.mark.lng),c.innerHTML='<img src="./assets/images/icon/pin.svg">Ouvrir dans le GPS',n.appendChild(r),n.appendChild(t),n.appendChild(a);var l=this.markerOpenedState(e.mark.timetable);n.appendChild(l);for(var h=!0,m=0;m<e.mark.timetable.length;++m)if(!0===e.mark.timetable[m].isOpen){h=!1;break}return e.mark.timetable.length>0&&!1===h&&l.addEventListener("click",this.timetableModal.bind(this,e.mark,e.user)),""!==e.mark.info&&n.appendChild(i),""!==e.mark.phone&&n.appendChild(o),""!==e.mark.website&&n.appendChild(s),n.appendChild(c),n}},{key:"createStopMarkerPopup",value:function(e){var n=document.createElement("DIV"),r=document.createElement("IMG"),t=document.createElement("H3"),a=document.createElement("H4"),o=document.createElement("I"),s=document.createElement("I"),i=document.createElement("A"),c=document.createElement("A"),l=document.createElement("A"),h=document.createElement("A");return n.classList.add("marker-popup"),r.src="./assets/images/transportation/".concat(e.data.name,".png"),t.innerHTML=e.stop.name,!0===e.stop.terminus?a.innerHTML="Terminus de la ligne":a.innerHTML="Direction ".concat(e.stop.dir),o.innerHTML=e.stop.address,s.innerHTML=e.stop.town,i.href=e.stop.website,i.innerHTML='<img src="./assets/images/icon/web.svg">Consulter le site',i.setAttribute("rel","noopener noreferrer"),i.setAttribute("target","_blank"),c.href=e.stop.info,c.innerHTML='<img src="./assets/images/icon/info.svg">Informations',c.setAttribute("rel","noopener noreferrer"),c.setAttribute("target","_blank"),l.href="./assets/pdf/".concat(e.data.name,".pdf"),l.innerHTML='<img src="./assets/images/icon/download.svg">Télécharger les horaires',l.setAttribute("rel","noopener noreferrer"),l.setAttribute("target","_blank"),h.href="geo:".concat(e.stop.lat,",").concat(e.stop.lng),h.innerHTML='<img src="./assets/images/icon/pin.svg">Ouvrir dans le GPS',n.appendChild(r),n.appendChild(t),n.appendChild(a),n.appendChild(o),n.appendChild(s),""!==e.stop.info&&n.appendChild(c),""!==e.stop.website&&n.appendChild(i),n.appendChild(l),n.appendChild(h),n}},{key:"markerOpenedState",value:function(e){var n=document.createElement("DIV"),r=document.createElement("H5"),t=document.createElement("I");if(n.classList.add("marker-opened"),n.appendChild(r),n.appendChild(t),e.length){for(var a=!0,o=0;o<e.length;++o)if(!0===e[o].isOpen){a=!1;break}!0===a?this.markerIsClosed(n,!0):(this.checkTime(e,n),setInterval(this.checkTime.bind(this,e,n),6e4))}else this.markerIsOpened(n,!0);return n}},{key:"checkTime",value:function(e,n){var r=new Date,t=r.getHours(),a=r.getMinutes();a<10&&(a="0".concat(a));var o=(r.getDay()-1+7)%7,s=parseInt("".concat(e[o].open.h).concat(e[o].open.m)),i=parseInt("".concat(e[o].close.h).concat(e[o].close.m)),c=parseInt("".concat(t).concat(a));if(e[o].isOpen&&isNaN(s))this.markerIsOpened(n,!0);else if(e[o].isOpen&&c>=s&&c<i)if(e[o].break.hasBreak)if(e[o].break.several)for(var l=!1,h=0;h<e[o].break.several.length;++h){var m=parseInt("".concat(e[o].break.several[h].end.h).concat(e[o].break.several[h].end.m));if(c>=parseInt("".concat(e[o].break.several[h].start.h).concat(e[o].break.several[h].start.m))&&c<m){this.markerIsClosed(n),l=!0;break}l||this.markerIsOpened(n)}else{var d=parseInt("".concat(e[o].break.end.h).concat(e[o].break.end.m));c>=parseInt("".concat(e[o].break.start.h).concat(e[o].break.start.m))&&c<d?this.markerIsClosed(n):this.markerIsOpened(n)}else this.markerIsOpened(n);else this.markerIsClosed(n)}},{key:"markerIsOpened",value:function(e,n){e.firstChild.innerHTML="Ouvert",e.lastChild.innerHTML=!0===n?"Toujours ouvert":"Voir les horaires",e.classList.add("opened")}},{key:"markerIsClosed",value:function(e,n){e.firstChild.innerHTML="Fermé",e.lastChild.innerHTML=n?"Toujours fermé":"Voir les horaires",e.classList.remove("opened")}},{key:"timetableModal",value:function(e,n){var r=this;a.fetchModal("timetablemodal").then((function(t){t.querySelector("#mark-name").innerHTML=e.name,t.querySelector("#mark-address").innerHTML="".concat(e.address,", ").concat(e.town);var o=a.getDistanceBetweenCoords([e.lat,e.lng],[n.lat,n.lng]);t.querySelector("#mark-distance").innerHTML="Vous ètes à environ ".concat(a.convertDistanceToString(o)," de <b>").concat(e.name,"</b> à vol d'oiseau");var s=a.buildDistanceETA(o);t.querySelector("#mark-eta").innerHTML="Ce qui représente environ ".concat(s.car," en voiture, ou ").concat(s.walk," à pied."),t.querySelector("#mark-state").appendChild(r.markerOpenedState(e.timetable));for(var i=((new Date).getDay()-1+7)%7,c=0;c<e.timetable.length;++c){var l=t.querySelector("#timetable").children[c];if(!0===e.timetable[c].isOpen){var h=l.lastElementChild.firstElementChild,m=l.lastElementChild.lastElementChild;if(e.timetable[c].break&&!0===e.timetable[c].break.hasBreak)if(e.timetable[c].break.several){h.innerHTML="<p>".concat(e.timetable[c].open.h,":").concat(e.timetable[c].open.m," ‒ ").concat(e.timetable[c].break.several[0].start.h,":").concat(e.timetable[c].break.several[0].start.m,"</p>"),h.classList.add("filled"),h.classList.add("splited");for(var d=0;d<e.timetable[c].break.several.length-1;++d){var u=document.createElement("DIV");u.innerHTML="<p>".concat(e.timetable[c].break.several[d].end.h,":").concat(e.timetable[c].break.several[d].end.m," ‒ ").concat(e.timetable[c].break.several[d+1].start.h,":").concat(e.timetable[c].break.several[d+1].start.m,"</p>"),u.classList.add("filled"),u.classList.add("splited"),u.style.borderRadius=".5rem",u.style.justifyContent="center",l.lastElementChild.insertBefore(u,l.lastElementChild.lastElementChild)}m.innerHTML="<p>".concat(e.timetable[c].break.several[e.timetable[c].break.several.length-1].end.h,":").concat(e.timetable[c].break.several[e.timetable[c].break.several.length-1].end.m," ‒ ").concat(e.timetable[c].close.h,":").concat(e.timetable[c].close.m,"</p>"),m.classList.add("filled"),m.classList.add("splited")}else h.innerHTML="<p>".concat(e.timetable[c].open.h,":").concat(e.timetable[c].open.m," ‒ ").concat(e.timetable[c].break.start.h,":").concat(e.timetable[c].break.start.m,"</p>"),h.classList.add("filled"),h.classList.add("splited"),m.innerHTML="<p>".concat(e.timetable[c].break.end.h,":").concat(e.timetable[c].break.end.m," ‒ ").concat(e.timetable[c].close.h,":").concat(e.timetable[c].close.m,"</p>"),m.classList.add("filled"),m.classList.add("splited");else e.timetable[c].open.h&&e.timetable[c].close.h?(h.innerHTML="<p>".concat(e.timetable[c].open.h,":").concat(e.timetable[c].open.m,"</p>"),h.classList.add("filled"),m.innerHTML="<p>".concat(e.timetable[c].close.h,":").concat(e.timetable[c].close.m,"</p>"),m.classList.add("filled")):(h.innerHTML="<p>00:00</p>",h.classList.add("filled"),m.innerHTML="<p>24:00</p>",m.classList.add("filled"))}else l.lastElementChild.innerHTML='<div class="closed"><p>Fermé</p></div>';c===i&&l.classList.add("today")}document.getElementById("modal-overlay").appendChild(t),document.getElementById("modal-overlay").style.display="flex",setTimeout((function(){return document.getElementById("modal-overlay").style.opacity=1}),50)}))}}],null&&s(e.prototype,null),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function h(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,m(t.key),t)}}function m(e){var n=function(e,n){if("object"!=l(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,"string");if("object"!=l(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==l(n)?n:n+""}window.tmp=[];var d=function(){return e=function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=n.targetId,this._map=null,this._layers={Carte:null,Satellite:null},this._marks={},this._polygons={},this._lines=[],this._init(),this._events()},(n=[{key:"_init",value:function(){this._map=window.L.map(this._id,{zoomControl:!1}).setView([a.CCDH_CENTER.LAT,a.CCDH_CENTER.LNG],12),window.L.control.scale().addTo(this._map),this._map.setMaxBounds(a.MAP_BOUNDS),this._layers.Carte=a.OSM_LAYER,this._layers.Satellite=a.ESRI_LAYER,this._layers.Carte.addTo(this._map),window.L.control.layers(this._layers,{},{position:"bottomright"}).addTo(this._map)}},{key:"_events",value:function(){var e=this;this._map.on("click",this._mapClicked.bind(this)),this._map.on("drag",(function(){e._map.panInsideBounds(a.MAP_BOUNDS,{animate:!0})}))}},{key:"_mapClicked",value:function(e){console.log(e.latlng,JSON.stringify(e.latlng.lat+", "+e.latlng.lng)),window.tmp.push([e.latlng.lat,e.latlng.lng]),console.log(JSON.stringify(window.tmp))}},{key:"drawUserMarker",value:function(){window.dx.user.marker?window.dx.user.marker.setLatLng(window.dx.user):(window.dx.user.marker=window.L.marker([window.dx.user.lat,window.dx.user.lng],{icon:r.subtypes.user}),window.dx.user.marker.addTo(this._map))}},{key:"addPolygon",value:function(e,n){var r=this;return new Promise((function(t){var a=window.L.polygon(e);a.addTo(r._map),r._polygons[n]=a,t()}))}},{key:"createMarker",value:function(e){var n=this;return new Promise((function(t){var a=e.mark.type,o=window.L.marker([e.mark.lat,e.mark.lng],{icon:r.subtypes[a]}).on("click",(function(){n._map.flyTo([e.mark.lat,e.mark.lng],18)}));if(o.bindPopup(c.createMarkerPopup(e)),e.mark.subtypes.length>0)for(var s=0;s<e.mark.subtypes.length;++s)n._marks[e.mark.subtypes[s]]||(n._marks[e.mark.subtypes[s]]=[]),n._marks[e.mark.subtypes[s]].push(o);else n._marks[a]||(n._marks[a]=[]),n._marks[a].push(o);t()}))}},{key:"showCategory",value:function(e){for(var n=r.types[e],t=0;t<n.length;++t)this.showSubCategory(n[t])}},{key:"showSubCategory",value:function(e){var n=this._marks[e];if(n)for(var r=0;r<n.length;++r)n[r].addTo(this._map)}},{key:"hideCategory",value:function(e){for(var n=r.types[e],t=0;t<n.length;++t)this.hideSubCategory(n[t])}},{key:"hideSubCategory",value:function(e){var n=this._marks[e];if(n)for(var r=0;r<n.length;++r)n[r].removeFrom(this._map)}},{key:"addTransportationStop",value:function(e){var n=this;return new Promise((function(t){var a=e.stop.type,o=window.L.marker([e.stop.lat,e.stop.lng],{icon:r.subtypes[a]}).on("click",(function(){n._map.flyTo([e.stop.lat,e.stop.lng],18)})),s=window.L.polyline(e.data.path,{color:e.data.color,weight:5,smoothFactor:1});o.bindPopup(c.createStopMarkerPopup(e)).on("popupopen",(function(){s.addTo(n._map)})).on("popupclose",(function(){s.removeFrom(n._map)})),n._marks[a]||(n._marks[a]=[]),n._marks[a].push(o),t()}))}},{key:"addLine",value:function(e,n){this._lines.push(window.L.polyline(e,n).addTo(this._map))}}])&&h(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}();function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function p(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,g(t.key),t)}}function g(e){var n=function(e,n){if("object"!=u(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,"string");if("object"!=u(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(n)?n:n+""}var w=function(){return e=function e(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),"boolean"!=typeof n&&(n=!1),this._debug=n,this._idIncrementor=5678*Math.floor(Math.random()*Math.floor(256)),this._regularEvents=[],this._customEvents={},this.version="1.2.1"},n=[{key:"destroy",value:function(){var e=this;this._raise("log","Evts.destroy"),this.removeAllEvents(),Object.keys(this).forEach((function(n){delete e[n]}))}},{key:"addEvent",value:function(e,n,r){var t=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this._raise("log","Evts.addEvent: ".concat(e," ").concat(n," ").concat(r," ").concat(a," ").concat(o)),null==e||null==n||null==r)return this._raise("error","Evts.addEvent: Missing mandatory arguments"),!1;return"string"!=typeof e||"object"!==u(n)||"function"!=typeof r||null!=a&&"object"!==u(a)||null!=o&&"object"!==u(o)&&"boolean"!=typeof o?(t._raise("error","Evts.addEvent: Wrong type for argument"),!1):(r=r.bind(a),this._regularEvents.push({id:this._idIncrementor,element:n,eventName:e,scope:a,callback:r,options:o}),n.addEventListener(e,r,o),this._idIncrementor++)}},{key:"removeEvent",value:function(e){if(this._raise("log","Events.removeEvent: ".concat(e)),null==e)return this._raise("error","Evts.removeEvent: Missing mandatory arguments"),!1;if("number"!=typeof e)return this._raise("error","Evts.removeEvent: Wrong type for argument"),!1;for(var n=!1,r=this._regularEvents.length-1;r>=0;--r)this._regularEvents[r].id===e&&(n=!0,this._clearRegularEvent(r));return n}},{key:"removeAllEvents",value:function(){this._raise("log","Evts.removeAllEvents");for(var e=!1,n=this._regularEvents.length>0,r=this._regularEvents.length-1;r>=0;--r)this._clearRegularEvent(r);return 0===this._regularEvents.length&&n&&(e=!0),e}},{key:"_clearRegularEvent",value:function(e){if(this._raise("log","Evts._clearRegularEvent: ".concat(e)),null==e)return this._raise("error","Evts._clearRegularEvent: Missing mandatory argument"),!1;if("number"!=typeof e)return this._raise("error","Evts._clearRegularEvent: Wrong type for argument"),!1;if(this._regularEvents[e]){var n=this._regularEvents[e];return n.element.removeEventListener(n.eventName,n.callback,n.options),this._regularEvents.splice(e,1),!0}return!1}},{key:"subscribe",value:function(e,n){var r=this,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._raise("log","Evts.subscribe: ".concat(e," ").concat(n," ").concat(t)),null==e||null==n)return this._raise("error","Evts.subscribe","Missing mandatory arguments"),!1;return"string"!=typeof e||"function"!=typeof n||null!=t&&"boolean"!=typeof t?(r._raise("error","Evts.subscribe: Wrong type for argument"),!1):(this._customEvents[e]||(this._customEvents[e]=[]),this._customEvents[e].push({id:this._idIncrementor,name:e,os:t,callback:n}),this._idIncrementor++)}},{key:"unsubscribe",value:function(e){if(this._raise("log","Evts.unsubscribe: ".concat(e)),null==e)return this._raise("error","Evts.unsubscribe: Missing mandatory arguments"),!1;if("number"!=typeof e)return this._raise("error","Evts.unsubscribe: Wrong type for argument"),!1;for(var n=!1,r=Object.keys(this._customEvents),t=r.length-1;t>=0;--t)for(var a=this._customEvents[r[t]],o=0;o<a.length;++o)if(a[o].id===e){this._raise("log","Evts.unsubscribe: subscription found\n",a[o],"\nSubscription n°".concat(e," for ").concat(a.name," has been removed")),n=!0,a.splice(o,1),0===a.length&&delete this._customEvents[r[t]];break}return n}},{key:"unsubscribeAllFor",value:function(e){if(this._raise("log","Evts.unsubscribeAllFor: ".concat(e)),null==e)return this._raise("error","Evts.unsubscribeAllFor: Missing mandatory arguments"),!1;if("string"!=typeof e)return this._raise("error","Evts.unsubscribeAllFor: Wrong type for argument"),!1;for(var n=!1,r=Object.keys(this._customEvents),t=0;t<r.length;++t)if(r[t]===e)for(var a=this._customEvents[r[t]],o=a.length-1;o>=0;--o)n=!0,a.splice(o,1),0===a.length&&delete this._customEvents[r[t]];return n}},{key:"publish",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._raise("log","Evts.publish: ".concat(e," ").concat(n)),null==e)return this._raise("error","Evts.publish: Missing mandatory arguments"),!1;if("string"!=typeof e||void 0!==n&&"object"!==u(n))return this._raise("error","Evts.publish: Wrong type for argument"),!1;for(var r=!1,t=Object.keys(this._customEvents),a=0;a<t.length;++a)if(t[a]===e){r=!0;for(var o=this._customEvents[t[a]],s=o.length-1;s>=0;--s)this._raise("log","Evts.publish: fire callback for ".concat(e,", subscription n°").concat(o[s].id),o[s]),o[s].callback(n),o[s].os&&(this._raise("log","Evts.publish: remove subscription because one shot usage is done"),o.splice(s,1),0===o.length&&delete this._customEvents[t[a]])}return r}},{key:"_raise",value:function(e,n){this._debug&&console[e](n)}}],n&&p(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}(),v=w;function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function k(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,y(t.key),t)}}function y(e){var n=function(e,n){if("object"!=f(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,"string");if("object"!=f(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==f(n)?n:n+""}window.Evts=new v;var b=function(){return e=function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this._map=null,this._cityBounds={},this._cityMarkers={},this._transportationLines={},this._displayedCategories=[],this._markerTokens=[],this._user={geolocationAllowed:!1,lat:a.HOME_LAT,lng:a.HOME_LNG,accuracy:0,marker:null},this._init()},n=[{key:"_init",value:function(){var e=this;this._initGeolocation().then(this._initMap.bind(this)).then(this._initEvents.bind(this)).then(this._fetchCityBounds.bind(this)).then(this._buildCityBounds.bind(this)).then(this._fetchCityMarkers.bind(this)).then(this._buildCityMarkers.bind(this)).then(this._fetchTransportationLines.bind(this)).then(this._buildTransportationLines.bind(this)).then((function(){console.log("we are done",e)}))}},{key:"_initGeolocation",value:function(){var e=this;return new Promise((function(n){if("geolocation"in navigator){var r={enableHighAccuracy:!0,maximumAge:1e3,timeout:900};navigator.geolocation.getCurrentPosition(e._positionInitialized.bind(e),null,r),e._watchId=navigator.geolocation.watchPosition(e._positionUpdate.bind(e),null,r)}n()}))}},{key:"_initMap",value:function(){var e=this;return new Promise((function(n){e._map=new d({targetId:"ccdh-map"}),n()}))}},{key:"_initEvents",value:function(){var e=this;return new Promise((function(n){document.getElementById("clear-filters").addEventListener("click",e._clearFilters.bind(e)),document.getElementById("modal-overlay").addEventListener("click",a.closeModal.bind(e));for(var r=document.getElementById("marker-selector").children,t=0;t<r.length;++t)r[t].addEventListener("click",e._markerCategoryClicked.bind(e,r[t]));n()}))}},{key:"_fetchCityBounds",value:function(){var e=this;return new Promise((function(n){for(var r=[],t=function(n){r.push(new Promise((function(r){fetch("./assets/json/citybounds/".concat(a.CCDH_CITIES[n],".json")).then((function(t){t.json().then((function(t){e._cityBounds[a.CCDH_CITIES[n]]=t,r()})).catch(r)})).catch(r)})))},o=0;o<a.CCDH_CITIES.length;++o)t(o);Promise.all(r).then(n)}))}},{key:"_buildCityBounds",value:function(){var e=this;return new Promise((function(n){for(var r=[],t=function(n){r.push(new Promise((function(r){e._map.addPolygon(e._cityBounds[a.CCDH_CITIES[n]].bounds,a.CCDH_CITIES[n]).then((function(){requestAnimationFrame(r)}))})))},o=0;o<a.CCDH_CITIES.length;++o)t(o);Promise.all(r).then(n)}))}},{key:"_fetchCityMarkers",value:function(){var e=this;return new Promise((function(n){for(var r=[],t=function(n){r.push(new Promise((function(r){fetch("./assets/json/citymarkers/".concat(a.CCDH_CITIES[n],".json")).then((function(t){t.json().then((function(t){e._cityMarkers[a.CCDH_CITIES[n]]=t.markers,r()})).catch(r)})).catch(r)})))},o=0;o<a.CCDH_CITIES.length;++o)t(o);Promise.all(r).then(n)}))}},{key:"_buildCityMarkers",value:function(){var e=this;return new Promise((function(n){for(var r=[],t=0;t<a.CCDH_CITIES.length;++t)for(var o=e._cityMarkers[a.CCDH_CITIES[t]],s=Object.keys(o),i=function(){for(var n=o[s[c]],t=function(t){r.push(new Promise((function(r){e._map.createMarker({mark:n[t],user:e._user}).then((function(){requestAnimationFrame(r)}))})))},a=0;a<n.length;++a)t(a)},c=0;c<s.length;++c)i();Promise.all(r).then(n)}))}},{key:"_fetchTransportationLines",value:function(){var e=this;return new Promise((function(n){fetch("./assets/json/transportation/transportation.json").then((function(r){r.json().then((function(r){e._transportationLines=r,n()})).catch(n)})).catch(n)}))}},{key:"_buildTransportationLines",value:function(){var e=this;return new Promise((function(n){for(var r=[],t=Object.keys(e._transportationLines),a=function(n){r.push(new Promise((function(r){for(var a=e._transportationLines[t[n]],o=0;o<a.stops.length;++o)e._map.addTransportationStop({data:a,stop:a.stops[o]}).then((function(){requestAnimationFrame(r)}))})))},o=0;o<t.length;++o)a(o);Promise.all(r).then(n)}))}},{key:"_markerCategoryClicked",value:function(e){e.classList.toggle("activated"),e.classList.contains("activated")?this._showCategory(e.dataset.type):this._hideCategory(e.dataset.type)}},{key:"_showCategory",value:function(e){this._map.showCategory(e);for(var n=r.types[e],t=0;t<n.length;++t){var a=document.createElement("IMG");a.src="./assets/images/marker/".concat(n[t],".svg"),a.dataset.type=n[t],document.getElementById("subitems-wrapper").appendChild(a),this._markerTokens.push(window.Evts.addEvent("click",a,this._markerTypeClicked,{scope:this,element:a}))}this._displayedCategories.push(e),document.getElementById("subitems-wrapper").classList.add("show"),document.getElementById("clear-filters").classList.add("active")}},{key:"_hideCategory",value:function(e){if(this._map.hideCategory(e),this._displayedCategories.splice(this._displayedCategories.indexOf(e),1),0===this._displayedCategories.length){document.getElementById("subitems-wrapper").classList.remove("show");for(var n=0;n<this._markerTokens.length;++n)window.Evts.removeEvent(this._markerTokens[n]);document.getElementById("clear-filters").classList.remove("active")}this._clearSpecificMarkers(e)}},{key:"_markerTypeClicked",value:function(){var e=this.element;e.classList.toggle("deactivated"),e.classList.contains("deactivated")?this.scope._map.hideSubCategory(e.dataset.type):this.scope._map.showSubCategory(e.dataset.type)}},{key:"_clearSpecificMarkers",value:function(e){for(var n=document.getElementById("subitems-wrapper").children,t=n.length-1;t>=0;--t)-1!==r.types[e].indexOf(n[t].dataset.type)&&document.getElementById("subitems-wrapper").removeChild(n[t])}},{key:"_clearFilters",value:function(){if(document.getElementById("clear-filters").classList.contains("active")){document.getElementById("clear-filters").classList.remove("active");for(var e=Object.keys(r.types),n=0;n<e.length;++n)this._hideCategory(e[n]);for(var t=document.getElementById("marker-selector").children,a=0;a<t.length;++a)t[a].classList.remove("activated")}}},{key:"_positionInitialized",value:function(){this._user.geolocationAllowed=!0}},{key:"_positionUpdate",value:function(e){!0===this._user.geolocationAllowed&&(this._user.lat=e.coords.latitude,this._user.lng=e.coords.longitude,this._user.accuracy=e.coords.accuracy,this._map&&this._map.drawUserMarker())}},{key:"user",get:function(){return this._user}}],n&&k(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}();window.MonDourdannais=n.default}();